---
title: 'Title'
author: "Miao Sun"
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  prettydoc::html_pretty:
    theme: HPSTR
    highlight: github
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      messages = FALSE, 
                      warning = FALSE)
library(readr)
library(tidyverse)
library(knitr)
library(plotly)
library(broom)
library(DT)
annual_number_of_deaths_by_cause <- read_csv("Data/annual-number-of-deaths-by-cause.csv", 
    col_types = cols(`Number of executions` = col_double()))
GDP <- read_csv("Data/GDP.csv")
```

```{r}
df_global <-  annual_number_of_deaths_by_cause %>%
  filter(Year %in% c(1950:2018)) %>%
  pivot_longer(
    cols =  -c(Country, Code, Year),
    names_to = "Death_cause",
    values_to = "Count"
  )

df_CI <- df_global %>%
  filter(Country %in% c("China", "India"))

interest <- c(
  "Cardiovascular diseases",
  "Diabetes mellitus",
  "HIV/AIDS",
  "Neoplasms",
  "Nutritional deficiencies",
  "Malaria"
)
```



```{r}
CI_Percent <- df_CI %>%
  group_by(Country,
           Year) %>%
  mutate(Total_death = sum(Count, na.rm = TRUE) * 100) %>%
  group_by(Country,
           Year,
           Death_cause,
           Total_death) %>%
  summarize(Percentage = Count / Total_death * 100) %>%
  group_by(Country,
           Death_cause) %>%
  arrange(desc(Percentage)) %>%
  filter(Death_cause %in% interest)

CI_Total <- df_CI %>%
  group_by(Country,
           Year,
           Death_cause) %>%
  mutate(Death_abs = sum(Count, na.rm = TRUE)) %>%
  filter(Death_cause %in% interest) %>%
  group_by(Year,
           Country,
           Death_cause,
           Death_abs) %>%
  summarise() %>%
  left_join(GDP, by = c ("Country" = "Entity",
                         "Year" = "Year"))
```
## Introduction:

The health condition are different due to the resources different countries control. Which lead to an inequality in health in different areas @emadi2021global. Country in different developing condition would have different health conditions. This section will focus on 2 typical developing countries : China and India. Investigate the disease that cause the death in these 2 countries most and how they are related with the GDP per capita.


## Research Question:


### Q1: What are the diseases that growing fastest in developing country?


### Q2: How the diseases changes with the change of GDP per capita?


```{r Percentage Change in China and India}
Percentage_trend <- CI_Percent %>%
  ggplot(aes(x = Year,
             y = Percentage,
             color = Death_cause)) +
  geom_line() +
  facet_wrap( ~ Country, nrow = 2, scales = "free_y")

Absolute_trend <- CI_Total %>%
  ggplot(aes(x = Year)) +
  geom_line(aes(y = Death_abs,
                color = Death_cause)) +
  geom_line(aes(y = gdppc * 500)) +
  facet_wrap( ~ Country, nrow = 2, scales = "free_y")


ggplotly(Percentage_trend)
ggplotly(Absolute_trend)
```


```{r Run regression with the number of deasease against GDP per capita.}
CI_model <- CI_Total %>%
  filter(Death_cause %in% c("Cardiovascular diseases", "Neoplasms")) %>%
  group_by(Country,
           Death_cause) %>%
  nest() %>%
  mutate(model = map(
    .x = data,
    .f = function(x) {
      lm(Death_abs ~ gdppc,
         data = x)
    }
  ))

CI_coef <- CI_model %>%
  mutate (tidy = map(model, tidy)) %>%
  unnest(tidy) %>%
  select(Country, Death_cause, term, estimate) %>%
  pivot_wider(
    id_cols = c("Country", "Death_cause"),
    names_from = term,
    values_from = estimate
  ) %>%
  rename("intercept" = "(Intercept)",
         "slope" = "gdppc")

CI_model_fitness <- CI_model %>%
  mutate(glance = map(model, glance)) %>%
  unnest(glance) %>%
  select(Country, Death_cause, r.squared) %>%
  mutate(r.squared = round(r.squared, 2)) %>% 
  right_join(CI_coef) %>% 
  mutate(intercept = round(intercept, 2),
         slope = round(slope, 2))

datatable(CI_model_fitness)
```
In this graph, it is clear that both Cardiovascular diseases and Neoplasms contribute the most among other interested diseases in both China and India. additionally, Diabete are increasing as where. but slower than Cardiovascular diseases and Neoplasms so i will not discuses it. 

Further more, When we combine them with the GDP per capita graph. There is a clear trend that the death caused by these 2 disease are highly correlated with the GDP growth. After running regression. we found that more than 90% of death caused by Cardiovascular diseases and Neoplasms can be explained by the model. In China, for every 1 unit increase in the GDP per capita, the deaths caused by Cardiovascular diseases and Neoplasms are 182 and 90. In India, for every 1 unit increase in the GDP per capita, the deaths caused by Cardiovascular diseases and Neoplasms are 221 and 85 respectively.

This conclusion is corresponding to the common sense as well. because both Cardiovascular diseases and Neoplasms occurs more in area with higher income. Longer one lived, higher the possibility one can get these 2 diseases. Richer a country is, more resources can be used on transmitted disease like HIV and Malaria. therefore we can observed that death caused by transmitted diseases are decreasing to a very low level


## References: 
